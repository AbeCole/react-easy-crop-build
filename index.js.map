{"version":3,"file":"index.js","sources":["../src/helpers.ts","../src/index.tsx"],"sourcesContent":["import { Area, MediaSize, Point, Size } from './types'\n\n/**\n * Compute the dimension of the crop area based on media size,\n * aspect ratio and optionally rotation\n */\nexport function getCropSize(\n  mediaWidth: number,\n  mediaHeight: number,\n  containerWidth: number,\n  containerHeight: number,\n  aspect: number,\n  rotation = 0\n): Size {\n  const { width, height } = translateSize(mediaWidth, mediaHeight, rotation)\n  const fittingWidth = Math.min(width, containerWidth)\n  const fittingHeight = Math.min(height, containerHeight)\n\n  if (fittingWidth > fittingHeight * aspect) {\n    return {\n      width: fittingHeight * aspect,\n      height: fittingHeight,\n    }\n  }\n\n  return {\n    width: fittingWidth,\n    height: fittingWidth / aspect,\n  }\n}\n\n/**\n * Ensure a new media position stays in the crop area.\n */\nexport function restrictPosition(\n  position: Point,\n  mediaSize: Size,\n  cropSize: Size,\n  zoom: number,\n  rotation = 0\n): Point {\n  const { width, height } = translateSize(mediaSize.width, mediaSize.height, rotation)\n\n  return {\n    x: restrictPositionCoord(position.x, width, cropSize.width, zoom),\n    y: restrictPositionCoord(position.y, height, cropSize.height, zoom),\n  }\n}\n\nfunction restrictPositionCoord(\n  position: number,\n  mediaSize: number,\n  cropSize: number,\n  zoom: number\n): number {\n  const maxPosition = (mediaSize * zoom) / 2 - cropSize / 2\n  return Math.min(maxPosition, Math.max(position, -maxPosition))\n}\n\nexport function getDistanceBetweenPoints(pointA: Point, pointB: Point) {\n  return Math.sqrt(Math.pow(pointA.y - pointB.y, 2) + Math.pow(pointA.x - pointB.x, 2))\n}\n\nexport function getRotationBetweenPoints(pointA: Point, pointB: Point) {\n  return (Math.atan2(pointB.y - pointA.y, pointB.x - pointA.x) * 180) / Math.PI\n}\n\n/**\n * Compute the output cropped area of the media in percentages and pixels.\n * x/y are the top-left coordinates on the src media\n */\nexport function computeCroppedArea(\n  crop: Point,\n  mediaSize: MediaSize,\n  cropSize: Size,\n  aspect: number,\n  zoom: number,\n  rotation = 0,\n  restrictPosition = true\n): { croppedAreaPercentages: Area; croppedAreaPixels: Area } {\n  // if the media is rotated by the user, we cannot limit the position anymore\n  // as it might need to be negative.\n  const limitAreaFn = restrictPosition && rotation === 0 ? limitArea : noOp\n  const croppedAreaPercentages = {\n    x: limitAreaFn(\n      100,\n      (((mediaSize.width - cropSize.width / zoom) / 2 - crop.x / zoom) / mediaSize.width) * 100\n    ),\n    y: limitAreaFn(\n      100,\n      (((mediaSize.height - cropSize.height / zoom) / 2 - crop.y / zoom) / mediaSize.height) * 100\n    ),\n    width: limitAreaFn(100, ((cropSize.width / mediaSize.width) * 100) / zoom),\n    height: limitAreaFn(100, ((cropSize.height / mediaSize.height) * 100) / zoom),\n  }\n\n  // we compute the pixels size naively\n  const widthInPixels = Math.round(\n    limitAreaFn(\n      mediaSize.naturalWidth,\n      (croppedAreaPercentages.width * mediaSize.naturalWidth) / 100\n    )\n  )\n  const heightInPixels = Math.round(\n    limitAreaFn(\n      mediaSize.naturalHeight,\n      (croppedAreaPercentages.height * mediaSize.naturalHeight) / 100\n    )\n  )\n  const isImgWiderThanHigh = mediaSize.naturalWidth >= mediaSize.naturalHeight * aspect\n\n  // then we ensure the width and height exactly match the aspect (to avoid rounding approximations)\n  // if the media is wider than high, when zoom is 0, the crop height will be equals to iamge height\n  // thus we want to compute the width from the height and aspect for accuracy.\n  // Otherwise, we compute the height from width and aspect.\n  const sizePixels = isImgWiderThanHigh\n    ? {\n        width: Math.round(heightInPixels * aspect),\n        height: heightInPixels,\n      }\n    : {\n        width: widthInPixels,\n        height: Math.round(widthInPixels / aspect),\n      }\n  const croppedAreaPixels = {\n    ...sizePixels,\n    x: Math.round(\n      limitAreaFn(\n        mediaSize.naturalWidth - sizePixels.width,\n        (croppedAreaPercentages.x * mediaSize.naturalWidth) / 100\n      )\n    ),\n    y: Math.round(\n      limitAreaFn(\n        mediaSize.naturalHeight - sizePixels.height,\n        (croppedAreaPercentages.y * mediaSize.naturalHeight) / 100\n      )\n    ),\n  }\n  return { croppedAreaPercentages, croppedAreaPixels }\n}\n\n/**\n * Ensure the returned value is between 0 and max\n */\nfunction limitArea(max: number, value: number): number {\n  return Math.min(max, Math.max(0, value))\n}\n\nfunction noOp(_max: number, value: number) {\n  return value\n}\n\n/**\n * Compute the crop and zoom from the croppedAreaPixels\n */\nfunction getZoomFromCroppedAreaPixels(\n  croppedAreaPixels: Area,\n  mediaSize: MediaSize,\n  cropSize?: Size\n): number {\n  const mediaZoom = mediaSize.width / mediaSize.naturalWidth\n\n  if (cropSize) {\n    const isHeightMaxSize = cropSize.height > cropSize.width\n    return isHeightMaxSize\n      ? cropSize.height / mediaZoom / croppedAreaPixels.height\n      : cropSize.width / mediaZoom / croppedAreaPixels.width\n  }\n\n  const aspect = croppedAreaPixels.width / croppedAreaPixels.height\n  const isHeightMaxSize = mediaSize.naturalWidth >= mediaSize.naturalHeight * aspect\n  return isHeightMaxSize\n    ? mediaSize.naturalHeight / croppedAreaPixels.height\n    : mediaSize.naturalWidth / croppedAreaPixels.width\n}\n\n/**\n * Compute the crop and zoom from the croppedAreaPixels\n */\nexport function getInitialCropFromCroppedAreaPixels(\n  croppedAreaPixels: Area,\n  mediaSize: MediaSize,\n  cropSize?: Size\n): { crop: Point; zoom: number } {\n  const mediaZoom = mediaSize.width / mediaSize.naturalWidth\n\n  const zoom = getZoomFromCroppedAreaPixels(croppedAreaPixels, mediaSize, cropSize)\n\n  const cropZoom = mediaZoom * zoom\n\n  const crop = {\n    x: ((mediaSize.naturalWidth - croppedAreaPixels.width) / 2 - croppedAreaPixels.x) * cropZoom,\n    y: ((mediaSize.naturalHeight - croppedAreaPixels.height) / 2 - croppedAreaPixels.y) * cropZoom,\n  }\n  return { crop, zoom }\n}\n\n/**\n * Return the point that is the center of point a and b\n */\nexport function getCenter(a: Point, b: Point): Point {\n  return {\n    x: (b.x + a.x) / 2,\n    y: (b.y + a.y) / 2,\n  }\n}\n\n/**\n *\n * Returns an x,y point once rotated around xMid,yMid\n */\nexport function rotateAroundMidPoint(\n  x: number,\n  y: number,\n  xMid: number,\n  yMid: number,\n  degrees: number\n): [number, number] {\n  const cos = Math.cos\n  const sin = Math.sin\n  const radian = (degrees * Math.PI) / 180 // Convert to radians\n  // Subtract midpoints, so that midpoint is translated to origin\n  // and add it in the end again\n  const xr = (x - xMid) * cos(radian) - (y - yMid) * sin(radian) + xMid\n  const yr = (x - xMid) * sin(radian) + (y - yMid) * cos(radian) + yMid\n\n  return [xr, yr]\n}\n\n/**\n * Returns the new bounding area of a rotated rectangle.\n */\nexport function translateSize(width: number, height: number, rotation: number): Size {\n  const centerX = width / 2\n  const centerY = height / 2\n\n  const outerBounds = [\n    rotateAroundMidPoint(0, 0, centerX, centerY, rotation),\n    rotateAroundMidPoint(width, 0, centerX, centerY, rotation),\n    rotateAroundMidPoint(width, height, centerX, centerY, rotation),\n    rotateAroundMidPoint(0, height, centerX, centerY, rotation),\n  ]\n\n  const minX = Math.min(...outerBounds.map(p => p[0]))\n  const maxX = Math.max(...outerBounds.map(p => p[0]))\n  const minY = Math.min(...outerBounds.map(p => p[1]))\n  const maxY = Math.max(...outerBounds.map(p => p[1]))\n\n  return { width: maxX - minX, height: maxY - minY }\n}\n\n/**\n * Combine multiple class names into a single string.\n */\nexport function classNames(...args: (boolean | string | number | undefined | void | null)[]) {\n  return args\n    .filter(value => {\n      if (typeof value === 'string' && value.length > 0) {\n        return true\n      }\n\n      return false\n    })\n    .join(' ')\n    .trim()\n}\n","import React from 'react'\nimport normalizeWheel from 'normalize-wheel'\nimport { Area, MediaSize, Point, Size, VideoSrc } from './types'\nimport {\n  getCropSize,\n  restrictPosition,\n  getDistanceBetweenPoints,\n  getRotationBetweenPoints,\n  computeCroppedArea,\n  getCenter,\n  getInitialCropFromCroppedAreaPixels,\n  classNames,\n} from './helpers'\nimport cssStyles from './styles.css'\n\nexport type CropperProps = {\n  image?: string\n  video?: string | VideoSrc[]\n  transform?: string\n  crop: Point\n  zoom: number\n  rotation: number\n  aspect: number\n  minZoom: number\n  maxZoom: number\n  cropShape: 'rect' | 'round'\n  cropSize?: Size\n  objectFit?: 'contain' | 'horizontal-cover' | 'vertical-cover'\n  showGrid?: boolean\n  zoomSpeed: number\n  zoomWithScroll?: boolean\n  onCropChange: (location: Point) => void\n  onZoomChange?: (zoom: number) => void\n  onRotationChange?: (rotation: number) => void\n  onCropComplete?: (croppedArea: Area, croppedAreaPixels: Area) => void\n  onCropAreaChange?: (croppedArea: Area, croppedAreaPixels: Area) => void\n  onCropSizeChange?: (cropSize: Size) => void\n  onInteractionStart?: () => void\n  onInteractionEnd?: () => void\n  onMediaLoaded?: (mediaSize: MediaSize, mediaRef: HTMLImageElement | HTMLVideoElement | null) => void\n  style: {\n    containerStyle?: React.CSSProperties\n    mediaStyle?: React.CSSProperties\n    cropAreaStyle?: React.CSSProperties\n  }\n  classes: {\n    containerClassName?: string\n    mediaClassName?: string\n    cropAreaClassName?: string\n  }\n  restrictPosition: boolean\n  initialCroppedAreaPixels?: Area\n  mediaProps: React.ImgHTMLAttributes<HTMLElement> | React.VideoHTMLAttributes<HTMLElement>\n  disableAutomaticStylesInjection?: boolean\n}\n\ntype State = {\n  cropSize: Size | null\n  hasWheelJustStarted: boolean\n}\n\nconst MIN_ZOOM = 1\nconst MAX_ZOOM = 3\n\nclass Cropper extends React.Component<CropperProps, State> {\n  static defaultProps = {\n    zoom: 1,\n    rotation: 0,\n    aspect: 4 / 3,\n    maxZoom: MAX_ZOOM,\n    minZoom: MIN_ZOOM,\n    cropShape: 'rect',\n    objectFit: 'contain',\n    showGrid: true,\n    style: {},\n    classes: {},\n    mediaProps: {},\n    zoomSpeed: 1,\n    restrictPosition: true,\n    zoomWithScroll: true,\n  }\n\n  imageRef: HTMLImageElement | null = null\n  videoRef: HTMLVideoElement | null = null\n  containerRef: HTMLDivElement | null = null\n  styleRef: HTMLStyleElement | null = null\n  containerRect: DOMRect | null = null\n  mediaSize: MediaSize = { width: 0, height: 0, naturalWidth: 0, naturalHeight: 0 }\n  dragStartPosition: Point = { x: 0, y: 0 }\n  dragStartCrop: Point = { x: 0, y: 0 }\n  lastPinchDistance = 0\n  lastPinchRotation = 0\n  rafDragTimeout: number | null = null\n  rafPinchTimeout: number | null = null\n  wheelTimer: number | null = null\n\n  state: State = {\n    cropSize: null,\n    hasWheelJustStarted: false,\n  }\n\n  componentDidMount() {\n    window.addEventListener('resize', this.computeSizes)\n    if (this.containerRef) {\n      this.props.zoomWithScroll &&\n        this.containerRef.addEventListener('wheel', this.onWheel, { passive: false })\n      this.containerRef.addEventListener('gesturestart', this.preventZoomSafari)\n      this.containerRef.addEventListener('gesturechange', this.preventZoomSafari)\n    }\n\n    if (!this.props.disableAutomaticStylesInjection) {\n      this.styleRef = document.createElement('style')\n      this.styleRef.setAttribute('type', 'text/css')\n      this.styleRef.innerHTML = cssStyles\n      document.head.appendChild(this.styleRef)\n    }\n\n    // when rendered via SSR, the image can already be loaded and its onLoad callback will never be called\n    if (this.imageRef && this.imageRef.complete) {\n      this.onMediaLoad()\n    }\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('resize', this.computeSizes)\n    if (this.containerRef) {\n      this.containerRef.removeEventListener('gesturestart', this.preventZoomSafari)\n      this.containerRef.removeEventListener('gesturechange', this.preventZoomSafari)\n    }\n\n    if (this.styleRef) {\n      this.styleRef.parentNode?.removeChild(this.styleRef)\n    }\n\n    this.cleanEvents()\n    this.props.zoomWithScroll && this.clearScrollEvent()\n  }\n\n  componentDidUpdate(prevProps: CropperProps) {\n    if (prevProps.rotation !== this.props.rotation) {\n      this.computeSizes()\n      this.recomputeCropPosition()\n    } else if (prevProps.aspect !== this.props.aspect) {\n      this.computeSizes()\n    } else if (prevProps.zoom !== this.props.zoom) {\n      this.recomputeCropPosition()\n    } else if (\n      prevProps.cropSize?.height !== this.props.cropSize?.height ||\n      prevProps.cropSize?.width !== this.props.cropSize?.width\n    ) {\n      this.computeSizes()\n    } else if (\n      prevProps.crop?.x !== this.props.crop?.x ||\n      prevProps.crop?.y !== this.props.crop?.y\n    ) {\n      this.emitCropAreaChange()\n    }\n    if (prevProps.zoomWithScroll !== this.props.zoomWithScroll && this.containerRef) {\n      this.props.zoomWithScroll\n        ? this.containerRef.addEventListener('wheel', this.onWheel, { passive: false })\n        : this.clearScrollEvent()\n    }\n    if (prevProps.video !== this.props.video) {\n        this.videoRef?.load()\n    }\n  }\n\n  // this is to prevent Safari on iOS >= 10 to zoom the page\n  preventZoomSafari = (e: Event) => e.preventDefault()\n\n  cleanEvents = () => {\n    document.removeEventListener('mousemove', this.onMouseMove)\n    document.removeEventListener('mouseup', this.onDragStopped)\n    document.removeEventListener('touchmove', this.onTouchMove)\n    document.removeEventListener('touchend', this.onDragStopped)\n  }\n\n  clearScrollEvent = () => {\n    if (this.containerRef) this.containerRef.removeEventListener('wheel', this.onWheel)\n    if (this.wheelTimer) {\n      clearTimeout(this.wheelTimer)\n    }\n  }\n\n  onMediaLoad = () => {\n    this.computeSizes()\n    this.emitCropData()\n    this.setInitialCrop()\n\n    if (this.props.onMediaLoaded) {\n      console.log('calling on media loaded', this.imageRef, this.videoRef);\n      this.props.onMediaLoaded(this.mediaSize, this.imageRef || this.videoRef)\n    }\n  }\n\n  setInitialCrop = () => {\n    const { initialCroppedAreaPixels, cropSize } = this.props\n\n    if (!initialCroppedAreaPixels) {\n      return\n    }\n\n    const { crop, zoom } = getInitialCropFromCroppedAreaPixels(\n      initialCroppedAreaPixels,\n      this.mediaSize,\n      cropSize\n    )\n    this.props.onCropChange(crop)\n    this.props.onZoomChange && this.props.onZoomChange(zoom)\n  }\n\n  getAspect() {\n    const { cropSize, aspect } = this.props\n    if (cropSize) {\n      return cropSize.width / cropSize.height\n    }\n    return aspect\n  }\n\n  computeSizes = () => {\n    const mediaRef = this.imageRef || this.videoRef\n    if (mediaRef && this.containerRef) {\n      this.containerRect = this.containerRef.getBoundingClientRect()\n\n      this.mediaSize = {\n        width: mediaRef.offsetWidth,\n        height: mediaRef.offsetHeight,\n        naturalWidth: this.imageRef?.naturalWidth || this.videoRef?.videoWidth || 0,\n        naturalHeight: this.imageRef?.naturalHeight || this.videoRef?.videoHeight || 0,\n      }\n      const cropSize = this.props.cropSize\n        ? this.props.cropSize\n        : getCropSize(\n            mediaRef.offsetWidth,\n            mediaRef.offsetHeight,\n            this.containerRect.width,\n            this.containerRect.height,\n            this.props.aspect,\n            this.props.rotation\n          )\n\n      if (\n        this.state.cropSize?.height !== cropSize.height ||\n        this.state.cropSize?.width !== cropSize.width\n      ) {\n        this.props.onCropSizeChange && this.props.onCropSizeChange(cropSize)\n      }\n      this.setState({ cropSize }, this.recomputeCropPosition)\n    }\n  }\n\n  static getMousePoint = (e: MouseEvent | React.MouseEvent) => ({\n    x: Number(e.clientX),\n    y: Number(e.clientY),\n  })\n\n  static getTouchPoint = (touch: Touch | React.Touch) => ({\n    x: Number(touch.clientX),\n    y: Number(touch.clientY),\n  })\n\n  onMouseDown = (e: React.MouseEvent<HTMLDivElement, MouseEvent>) => {\n    e.preventDefault()\n    document.addEventListener('mousemove', this.onMouseMove)\n    document.addEventListener('mouseup', this.onDragStopped)\n    this.onDragStart(Cropper.getMousePoint(e))\n  }\n\n  onMouseMove = (e: MouseEvent) => this.onDrag(Cropper.getMousePoint(e))\n\n  onTouchStart = (e: React.TouchEvent<HTMLDivElement>) => {\n    e.preventDefault()\n    document.addEventListener('touchmove', this.onTouchMove, { passive: false }) // iOS 11 now defaults to passive: true\n    document.addEventListener('touchend', this.onDragStopped)\n    if (e.touches.length === 2) {\n      this.onPinchStart(e)\n    } else if (e.touches.length === 1) {\n      this.onDragStart(Cropper.getTouchPoint(e.touches[0]))\n    }\n  }\n\n  onTouchMove = (e: TouchEvent) => {\n    // Prevent whole page from scrolling on iOS.\n    e.preventDefault()\n    if (e.touches.length === 2) {\n      this.onPinchMove(e)\n    } else if (e.touches.length === 1) {\n      this.onDrag(Cropper.getTouchPoint(e.touches[0]))\n    }\n  }\n\n  onDragStart = ({ x, y }: Point) => {\n    this.dragStartPosition = { x, y }\n    this.dragStartCrop = { ...this.props.crop }\n    this.props.onInteractionStart?.()\n  }\n\n  onDrag = ({ x, y }: Point) => {\n    if (this.rafDragTimeout) window.cancelAnimationFrame(this.rafDragTimeout)\n\n    this.rafDragTimeout = window.requestAnimationFrame(() => {\n      if (!this.state.cropSize) return\n      if (x === undefined || y === undefined) return\n      const offsetX = x - this.dragStartPosition.x\n      const offsetY = y - this.dragStartPosition.y\n      const requestedPosition = {\n        x: this.dragStartCrop.x + offsetX,\n        y: this.dragStartCrop.y + offsetY,\n      }\n\n      const newPosition = this.props.restrictPosition\n        ? restrictPosition(\n            requestedPosition,\n            this.mediaSize,\n            this.state.cropSize,\n            this.props.zoom,\n            this.props.rotation\n          )\n        : requestedPosition\n      this.props.onCropChange(newPosition)\n    })\n  }\n\n  onDragStopped = () => {\n    this.cleanEvents()\n    this.emitCropData()\n    this.props.onInteractionEnd?.()\n  }\n\n  onPinchStart(e: React.TouchEvent<HTMLDivElement>) {\n    const pointA = Cropper.getTouchPoint(e.touches[0])\n    const pointB = Cropper.getTouchPoint(e.touches[1])\n    this.lastPinchDistance = getDistanceBetweenPoints(pointA, pointB)\n    this.lastPinchRotation = getRotationBetweenPoints(pointA, pointB)\n    this.onDragStart(getCenter(pointA, pointB))\n  }\n\n  onPinchMove(e: TouchEvent) {\n    const pointA = Cropper.getTouchPoint(e.touches[0])\n    const pointB = Cropper.getTouchPoint(e.touches[1])\n    const center = getCenter(pointA, pointB)\n    this.onDrag(center)\n\n    if (this.rafPinchTimeout) window.cancelAnimationFrame(this.rafPinchTimeout)\n    this.rafPinchTimeout = window.requestAnimationFrame(() => {\n      const distance = getDistanceBetweenPoints(pointA, pointB)\n      const newZoom = this.props.zoom * (distance / this.lastPinchDistance)\n      this.setNewZoom(newZoom, center)\n      this.lastPinchDistance = distance\n\n      const rotation = getRotationBetweenPoints(pointA, pointB)\n      const newRotation = this.props.rotation + (rotation - this.lastPinchRotation)\n      this.props.onRotationChange && this.props.onRotationChange(newRotation)\n      this.lastPinchRotation = rotation\n    })\n  }\n\n  onWheel = (e: WheelEvent) => {\n    e.preventDefault()\n    const point = Cropper.getMousePoint(e)\n    const { pixelY } = normalizeWheel(e)\n    const newZoom = this.props.zoom - (pixelY * this.props.zoomSpeed) / 200\n    this.setNewZoom(newZoom, point)\n\n    if (!this.state.hasWheelJustStarted) {\n      this.setState({ hasWheelJustStarted: true }, () => this.props.onInteractionStart?.())\n    }\n\n    if (this.wheelTimer) {\n      clearTimeout(this.wheelTimer)\n    }\n    this.wheelTimer = window.setTimeout(\n      () => this.setState({ hasWheelJustStarted: false }, () => this.props.onInteractionEnd?.()),\n      250\n    )\n  }\n\n  getPointOnContainer = ({ x, y }: Point) => {\n    if (!this.containerRect) {\n      throw new Error('The Cropper is not mounted')\n    }\n    return {\n      x: this.containerRect.width / 2 - (x - this.containerRect.left),\n      y: this.containerRect.height / 2 - (y - this.containerRect.top),\n    }\n  }\n\n  getPointOnMedia = ({ x, y }: Point) => {\n    const { crop, zoom } = this.props\n    return {\n      x: (x + crop.x) / zoom,\n      y: (y + crop.y) / zoom,\n    }\n  }\n\n  setNewZoom = (zoom: number, point: Point) => {\n    if (!this.state.cropSize || !this.props.onZoomChange) return\n\n    const zoomPoint = this.getPointOnContainer(point)\n    const zoomTarget = this.getPointOnMedia(zoomPoint)\n    const newZoom = Math.min(this.props.maxZoom, Math.max(zoom, this.props.minZoom))\n    const requestedPosition = {\n      x: zoomTarget.x * newZoom - zoomPoint.x,\n      y: zoomTarget.y * newZoom - zoomPoint.y,\n    }\n    const newPosition = this.props.restrictPosition\n      ? restrictPosition(\n          requestedPosition,\n          this.mediaSize,\n          this.state.cropSize,\n          newZoom,\n          this.props.rotation\n        )\n      : requestedPosition\n\n    this.props.onCropChange(newPosition)\n    this.props.onZoomChange(newZoom)\n  }\n\n  getCropData = () => {\n    if (!this.state.cropSize) {\n      return null\n    }\n\n    // this is to ensure the crop is correctly restricted after a zoom back (https://github.com/ricardo-ch/react-easy-crop/issues/6)\n    const restrictedPosition = this.props.restrictPosition\n      ? restrictPosition(\n          this.props.crop,\n          this.mediaSize,\n          this.state.cropSize,\n          this.props.zoom,\n          this.props.rotation\n        )\n      : this.props.crop\n    return computeCroppedArea(\n      restrictedPosition,\n      this.mediaSize,\n      this.state.cropSize,\n      this.getAspect(),\n      this.props.zoom,\n      this.props.rotation,\n      this.props.restrictPosition\n    )\n  }\n\n  emitCropData = () => {\n    const cropData = this.getCropData()\n    if (!cropData) return\n\n    const { croppedAreaPercentages, croppedAreaPixels } = cropData\n    if (this.props.onCropComplete) {\n      this.props.onCropComplete(croppedAreaPercentages, croppedAreaPixels)\n    }\n\n    if (this.props.onCropAreaChange) {\n      this.props.onCropAreaChange(croppedAreaPercentages, croppedAreaPixels)\n    }\n  }\n\n  emitCropAreaChange = () => {\n    const cropData = this.getCropData()\n    if (!cropData) return\n\n    const { croppedAreaPercentages, croppedAreaPixels } = cropData\n    if (this.props.onCropAreaChange) {\n      this.props.onCropAreaChange(croppedAreaPercentages, croppedAreaPixels)\n    }\n  }\n\n  recomputeCropPosition = () => {\n    if (!this.state.cropSize) return\n\n    const newPosition = this.props.restrictPosition\n      ? restrictPosition(\n          this.props.crop,\n          this.mediaSize,\n          this.state.cropSize,\n          this.props.zoom,\n          this.props.rotation\n        )\n      : this.props.crop\n    this.props.onCropChange(newPosition)\n    this.emitCropData()\n  }\n\n  render() {\n    const {\n      image,\n      video,\n      mediaProps,\n      transform,\n      crop: { x, y },\n      rotation,\n      zoom,\n      cropShape,\n      showGrid,\n      style: { containerStyle, cropAreaStyle, mediaStyle },\n      classes: { containerClassName, cropAreaClassName, mediaClassName },\n      objectFit,\n    } = this.props\n\n    return (\n      <div\n        onMouseDown={this.onMouseDown}\n        onTouchStart={this.onTouchStart}\n        ref={(el) => (this.containerRef = el)}\n        data-testid=\"container\"\n        style={containerStyle}\n        className={classNames('reactEasyCrop_Container', containerClassName)}\n      >\n        {image ? (\n          <img\n            alt=\"\"\n            className={classNames(\n              'reactEasyCrop_Image',\n              objectFit === 'contain' && 'reactEasyCrop_Contain',\n              objectFit === 'horizontal-cover' && 'reactEasyCrop_Cover_Horizontal',\n              objectFit === 'vertical-cover' && 'reactEasyCrop_Cover_Vertical',\n              mediaClassName\n            )}\n            {...(mediaProps as React.ImgHTMLAttributes<HTMLElement>)}\n            src={image}\n            ref={(el: HTMLImageElement) => (this.imageRef = el)}\n            style={{\n              ...mediaStyle,\n              transform:\n                transform || `translate(${x}px, ${y}px) rotate(${rotation}deg) scale(${zoom})`,\n            }}\n            onLoad={this.onMediaLoad}\n          />\n        ) : (\n          video && (\n            <video\n              autoPlay\n              loop\n              muted={true}\n              className={classNames(\n                'reactEasyCrop_Video',\n                objectFit === 'contain' && 'reactEasyCrop_Contain',\n                objectFit === 'horizontal-cover' && 'reactEasyCrop_Cover_Horizontal',\n                objectFit === 'vertical-cover' && 'reactEasyCrop_Cover_Vertical',\n                mediaClassName\n              )}\n              {...mediaProps}\n              ref={(el: HTMLVideoElement) => (this.videoRef = el)}\n              onLoadedMetadata={this.onMediaLoad}\n              style={{\n                ...mediaStyle,\n                transform:\n                  transform || `translate(${x}px, ${y}px) rotate(${rotation}deg) scale(${zoom})`,\n              }}\n              controls={false}\n            >\n              {(Array.isArray(video) ? video : [{ src: video }]).map((item) => (\n                <source key={item.src} {...item} />\n              ))}\n            </video>\n          )\n        )}\n        {this.state.cropSize && (\n          <div\n            style={{\n              ...cropAreaStyle,\n              width: this.state.cropSize.width,\n              height: this.state.cropSize.height,\n            }}\n            data-testid=\"cropper\"\n            className={classNames(\n              'reactEasyCrop_CropArea',\n              cropShape === 'round' && 'reactEasyCrop_CropAreaRound',\n              showGrid && 'reactEasyCrop_CropAreaGrid',\n              cropAreaClassName\n            )}\n          />\n        )}\n      </div>\n    )\n  }\n}\n\nexport default Cropper\n"],"names":["getCropSize","mediaWidth","mediaHeight","containerWidth","containerHeight","aspect","rotation","_a","translateSize","width","height","fittingWidth","Math","min","fittingHeight","restrictPosition","position","mediaSize","cropSize","zoom","x","restrictPositionCoord","y","maxPosition","max","getDistanceBetweenPoints","pointA","pointB","sqrt","pow","getRotationBetweenPoints","atan2","PI","computeCroppedArea","crop","limitAreaFn","limitArea","noOp","croppedAreaPercentages","widthInPixels","round","naturalWidth","heightInPixels","naturalHeight","isImgWiderThanHigh","sizePixels","croppedAreaPixels","value","_max","getZoomFromCroppedAreaPixels","mediaZoom","isHeightMaxSize_1","isHeightMaxSize","getInitialCropFromCroppedAreaPixels","cropZoom","getCenter","a","b","rotateAroundMidPoint","xMid","yMid","degrees","cos","sin","radian","xr","yr","centerX","centerY","outerBounds","minX","map","p","maxX","minY","maxY","classNames","_i","args","filter","length","join","trim","MIN_ZOOM","MAX_ZOOM","__extends","_this","hasWheelJustStarted","e","preventDefault","document","removeEventListener","onMouseMove","onDragStopped","onTouchMove","containerRef","onWheel","wheelTimer","clearTimeout","computeSizes","emitCropData","setInitialCrop","props","onMediaLoaded","console","log","imageRef","videoRef","initialCroppedAreaPixels","_b","onCropChange","onZoomChange","mediaRef","containerRect","getBoundingClientRect","offsetWidth","offsetHeight","videoWidth","videoHeight","state","onCropSizeChange","setState","recomputeCropPosition","addEventListener","onDragStart","Cropper","getMousePoint","onDrag","passive","touches","onPinchStart","getTouchPoint","onPinchMove","dragStartPosition","dragStartCrop","onInteractionStart","rafDragTimeout","window","cancelAnimationFrame","requestAnimationFrame","undefined","offsetX","offsetY","requestedPosition","newPosition","cleanEvents","onInteractionEnd","point","pixelY","normalizeWheel","newZoom","zoomSpeed","setNewZoom","setTimeout","Error","left","top","zoomPoint","getPointOnContainer","zoomTarget","getPointOnMedia","maxZoom","minZoom","restrictedPosition","getAspect","cropData","getCropData","onCropComplete","onCropAreaChange","zoomWithScroll","preventZoomSafari","disableAutomaticStylesInjection","styleRef","createElement","setAttribute","innerHTML","cssStyles","head","appendChild","complete","onMediaLoad","parentNode","removeChild","clearScrollEvent","prevProps","emitCropAreaChange","video","load","lastPinchDistance","lastPinchRotation","center","rafPinchTimeout","distance","newRotation","onRotationChange","image","mediaProps","transform","cropShape","showGrid","_c","containerStyle","cropAreaStyle","mediaStyle","_d","containerClassName","cropAreaClassName","mediaClassName","objectFit","React","onMouseDown","onTouchStart","ref","el","style","className","alt","src","onLoad","autoPlay","loop","muted","onLoadedMetadata","controls","Array","isArray","item","key","classes","Number","clientX","clientY","touch","Component"],"mappings":"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"}